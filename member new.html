<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aplikasi Member BRILink</title>
    
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Load React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Load Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Load LocalForage (Untuk Database IndexedDB - Kuat & Stabil untuk Data Tahunan) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.10.0/localforage.min.js"></script>

    <!-- Custom Styles -->
    <style>
        body { -webkit-tap-highlight-color: transparent; background-color: #f3f4f6; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Animasi */
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up { animation: fade-in-up 0.5s ease-out forwards; }
        
        @keyframes scale-up {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-scale-up { animation: scale-up 0.3s ease-out forwards; }

        @keyframes shimmer {
            100% { transform: translateX(100%); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .animate-shake { animation: shake 0.3s ease-in-out; }
        
        /* Loading Spinner */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- KONFIGURASI DATABASE (IndexedDB) ---
        // Menggunakan IndexedDB via LocalForage memastikan data tersimpan persisten
        // hingga bergiga-byte (tahunan) tanpa membebani memori RAM browser.
        localforage.config({
            name: 'BRILinkApp',
            storeName: 'brilink_database',
            description: 'Penyimpanan Data Member & Hadiah'
        });

        // --- ICONS COMPONENT ---
        const IconBase = ({ children, size = 24, className = "", strokeWidth = 2 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );

        const Icons = {
            Users: (props) => <IconBase {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></IconBase>,
            PlusCircle: (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></IconBase>,
            History: (props) => <IconBase {...props}><path d="M3 3v5h5"/><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"/><path d="M12 7v5l4 2"/></IconBase>,
            Gift: (props) => <IconBase {...props}><polyline points="20 12 20 22 4 22 4 12"/><rect x="2" y="7" width="20" height="5"/><line x1="12" y1="22" x2="12" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></IconBase>,
            Trash2: (props) => <IconBase {...props}><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></IconBase>,
            Save: (props) => <IconBase {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></IconBase>,
            X: (props) => <IconBase {...props}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></IconBase>,
            Plus: (props) => <IconBase {...props}><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></IconBase>,
            Wallet: (props) => <IconBase {...props}><path d="M20 12V8H6a2 2 0 0 1-2-2c0-1.1.9-2 2-2h12v4"/><path d="M4 6v12c0 1.1.9 2 2 2h14v-4"/><path d="M18 12a2 2 0 0 0-2 2c0 1.1.9 2 2 2h4v-4h-4z"/></IconBase>,
            ChevronRight: (props) => <IconBase {...props}><polyline points="9 18 15 12 9 6"/></IconBase>,
            TrendingUp: (props) => <IconBase {...props}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></IconBase>,
            Award: (props) => <IconBase {...props}><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></IconBase>,
            Smartphone: (props) => <IconBase {...props}><rect x="5" y="2" width="14" height="20" rx="2" ry="2"/><line x1="12" y1="18" x2="12.01" y2="18"/></IconBase>,
            Search: (props) => <IconBase {...props}><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></IconBase>,
            Lock: (props) => <IconBase {...props}><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></IconBase>,
            LogOut: (props) => <IconBase {...props}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></IconBase>,
            Upload: (props) => <IconBase {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></IconBase>,
            Image: (props) => <IconBase {...props}><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></IconBase>,
            Download: (props) => <IconBase {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></IconBase>,
            Edit: (props) => <IconBase {...props}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></IconBase>,
            BarChart: (props) => <IconBase {...props}><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></IconBase>,
        };

        // --- COMPONENT NAVBTN (MOBILE) ---
        const MobileNavBtn = ({ active, onClick, icon, label }) => (
            <button onClick={onClick} className={`flex flex-col items-center justify-center w-16 h-14 rounded-2xl transition-all duration-300 touch-manipulation ${active ? 'text-blue-600 bg-blue-50 scale-105 shadow-sm' : 'text-slate-300 active:text-slate-500'}`}>
                <div className={`mb-0.5 transition-transform duration-300 ${active ? '-translate-y-0.5' : 'translate-y-1'}`}>
                    {typeof icon === 'function' ? icon(active) : icon}
                </div>
                <span className={`text-[9px] font-bold transition-all duration-300 ${active ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-2 hidden'}`}>{label}</span>
            </button>
        );

        // --- COMPONENT NAVBTN (DESKTOP) ---
        const DesktopNavBtn = ({ active, onClick, icon, label }) => (
            <button onClick={onClick} className={`flex items-center gap-2 px-4 py-2 rounded-xl transition-all duration-300 ${active ? 'bg-white/20 text-white font-bold shadow-sm' : 'text-white/70 hover:bg-white/10 hover:text-white'}`}>
                {typeof icon === 'function' ? icon(active) : icon}
                <span className="text-sm">{label}</span>
            </button>
        );

        // --- MAIN APP ---
        const App = () => {
            // --- STATE (DATA) ---
            const [isLoading, setIsLoading] = useState(true);
            const [members, setMembers] = useState([]);
            const [transactions, setTransactions] = useState([]);
            const [rewards, setRewards] = useState([]);
            
            // --- STATE VISIBLE REWARDS (NEW) ---
            const [visibleRewards, setVisibleRewards] = useState(8); 

            // --- STATE EDIT ---
            const [editingTransaction, setEditingTransaction] = useState(null);
            const [editingReward, setEditingReward] = useState(null);
            const [editRewardName, setEditRewardName] = useState('');
            const [editRewardPoints, setEditRewardPoints] = useState('');
            const [editRewardImage, setEditRewardImage] = useState(null);

            // Default Data 
            const defaultRewards = [
                { id: 9, name: 'Motor Listrik', points: 10000, imageType: 'icon' },
                { id: 6, name: 'Mie Instan 1 Bks', points: 10, imageType: 'icon' },
                { id: 7, name: 'Minyak Goreng 1L', points: 20, imageType: 'icon' },
                { id: 8, name: 'Sabun Cuci', points: 30, imageType: 'icon' },
                { id: 10, name: 'Gula Pasir 1kg', points: 25, imageType: 'icon' },
                { id: 11, name: 'Teh Celup', points: 15, imageType: 'icon' },
                { id: 12, name: 'Kopi Sachet 5pcs', points: 15, imageType: 'icon' },
                { id: 13, name: 'Piring Cantik', points: 50, imageType: 'icon' },
            ];

            // --- EFFECT: LOAD DATA FROM DATABASE (IndexedDB) ---
            useEffect(() => {
                const loadData = async () => {
                    try {
                        const savedMembers = await localforage.getItem('brilink_members');
                        const savedTransactions = await localforage.getItem('brilink_transactions');
                        const savedRewards = await localforage.getItem('brilink_rewards');

                        setMembers(savedMembers || []);
                        setTransactions(savedTransactions || []);
                        setRewards(savedRewards || defaultRewards);
                    } catch (err) {
                        console.error("Error loading DB", err);
                    } finally {
                        setIsLoading(false);
                    }
                };
                loadData();
            }, []);

            // --- EFFECT: SAVE DATA TO DATABASE (IndexedDB) ---
            useEffect(() => {
                if (!isLoading) {
                    localforage.setItem('brilink_members', members);
                    localforage.setItem('brilink_transactions', transactions);
                    localforage.setItem('brilink_rewards', rewards).catch(err => {
                        if (err.name === 'QuotaExceededError') {
                            alert("⚠️ Memori HP Penuh. Hapus beberapa foto/video di HP Anda.");
                        } else {
                            console.error("Gagal menyimpan", err);
                        }
                    });
                }
            }, [members, transactions, rewards, isLoading]);

            // --- STATE PAGINATION MEMBER ---
            const [currentPage, setCurrentPage] = useState(1);
            const [membersPerPage] = useState(20);
            const [searchTermAdmin, setSearchTermAdmin] = useState('');

            // --- STATE PAGINATION & SEARCH HISTORY (NEW - PENTING UNTUK DATA TAHUNAN) ---
            const [currentHistoryPage, setCurrentHistoryPage] = useState(1);
            const [historyPerPage] = useState(20); // Tampilkan 20 riwayat per halaman agar ringan
            const [searchHistory, setSearchHistory] = useState('');

            // --- STATE KEAMANAN ---
            const [isAdmin, setIsAdmin] = useState(false);
            const [pinInput, setPinInput] = useState('');
            const [showPinModal, setShowPinModal] = useState(false);
            const ADMIN_PIN = "709999"; 
            
            // State Pencarian Nasabah (Public)
            const [searchPhone, setSearchPhone] = useState('');
            const [searchResult, setSearchResult] = useState(null);
            const [hasSearched, setHasSearched] = useState(false);

            const [view, setView] = useState('dashboard');
            const [modalType, setModalType] = useState(null);
            const [selectedMember, setSelectedMember] = useState(null);

            // Form States
            const [newMemberName, setNewMemberName] = useState('');
            const [newMemberPhone, setNewMemberPhone] = useState('');
            const [trxAmount, setTrxAmount] = useState('');
            const [trxProfit, setTrxProfit] = useState(''); 
            const [trxDescription, setTrxDescription] = useState('Transfer Sesama BRI'); 
            const [pointInput, setPointInput] = useState('');
            const [redeemNote, setRedeemNote] = useState('');
            
            // State Hadiah Baru + Upload Gambar
            const [newRewardName, setNewRewardName] = useState('');
            const [newRewardPoints, setNewRewardPoints] = useState('');
            const [newRewardImage, setNewRewardImage] = useState(null);
            const fileInputRef = useRef(null);
            const restoreInputRef = useRef(null);

            // --- LOGIC BACKUP & RESTORE ---
            const handleBackup = () => {
                const data = { members, transactions, rewards, backupDate: new Date().toLocaleString() };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Backup_BRILink_${new Date().toISOString().slice(0,10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            };

            const handleRestore = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = async (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (data.members && data.transactions) {
                            if(window.confirm("⚠️ Mengembalikan data akan menimpa data yang ada sekarang. Lanjutkan?")) {
                                setIsLoading(true);
                                setMembers(data.members || []);
                                setTransactions(data.transactions || []);
                                setRewards(data.rewards || []);
                                
                                await localforage.setItem('brilink_members', data.members || []);
                                await localforage.setItem('brilink_transactions', data.transactions || []);
                                await localforage.setItem('brilink_rewards', data.rewards || []);
                                
                                alert("✅ Data berhasil dipulihkan!");
                                setIsLoading(false);
                            }
                        } else {
                            alert("❌ File tidak valid!");
                        }
                    } catch (err) { alert("❌ Gagal membaca file."); setIsLoading(false); }
                };
                reader.readAsText(file);
                if (restoreInputRef.current) restoreInputRef.current.value = "";
            };

            const handleResetData = async () => {
                if (prompt("Ketik 'HAPUS' untuk menghapus SEMUA data.") === 'HAPUS') {
                    setIsLoading(true);
                    setMembers([]);
                    setTransactions([]);
                    setRewards(defaultRewards);
                    await localforage.clear();
                    await localforage.setItem('brilink_rewards', defaultRewards);
                    setIsLoading(false);
                    alert("Data telah direset.");
                }
            };

            // --- LOGIC UMUM ---
            const handleLogin = (e) => {
                e.preventDefault();
                if (pinInput === ADMIN_PIN) {
                    setIsAdmin(true); setShowPinModal(false); setPinInput(''); setView('dashboard');
                } else {
                    alert("PIN Salah!");
                }
            };

            const handleLogout = () => { setIsAdmin(false); setView('dashboard'); setSearchPhone(''); setSearchResult(null); setHasSearched(false); };

            const handlePublicSearch = (e) => {
                e.preventDefault();
                setHasSearched(true);
                const result = members.find(m => m.phone === searchPhone);
                setSearchResult(result || null);
            };

            const handleAddMember = (e) => {
                e.preventDefault();
                if (!newMemberName || !newMemberPhone) return alert('Nama dan No HP wajib diisi!');
                const newMember = { id: Date.now(), name: newMemberName, phone: newMemberPhone, points: 0, joinedDate: new Date().toLocaleDateString('id-ID') };
                setMembers([...members, newMember]); setNewMemberName(''); setNewMemberPhone(''); setView('members');
            };

            const handleTransaction = (e) => {
                e.preventDefault();
                if (!trxAmount) return;
                const pointsToAdd = 1; 
                const amount = parseInt(trxAmount.replace(/\./g, ''), 10);
                const profit = trxProfit ? parseInt(trxProfit.replace(/\./g, ''), 10) : 0; 
                
                const updatedMembers = members.map(m => (m.id === selectedMember.id ? { ...m, points: m.points + pointsToAdd } : m));
                
                const newTrx = { 
                    id: Date.now(), 
                    memberId: selectedMember.id, 
                    memberName: selectedMember.name, 
                    type: 'EARN', 
                    amount: amount,
                    profit: profit, 
                    description: trxDescription, 
                    points: pointsToAdd, 
                    date: new Date().toLocaleString('id-ID', { day: 'numeric', month: 'short', hour: '2-digit', minute:'2-digit' }) 
                };
                
                setMembers(updatedMembers); 
                setTransactions([newTrx, ...transactions]); 
                closeModal();
            };

            const handleRedeem = (e) => {
                e.preventDefault();
                const pointsToRedeem = parseInt(pointInput);
                if (selectedMember.points < pointsToRedeem) { alert('Poin tidak cukup!'); return; }
                const updatedMembers = members.map(m => (m.id === selectedMember.id ? { ...m, points: m.points - pointsToRedeem } : m));
                const newTrx = { id: Date.now(), memberId: selectedMember.id, memberName: selectedMember.name, type: 'REDEEM', note: redeemNote, points: pointsToRedeem, date: new Date().toLocaleString('id-ID', { day: 'numeric', month: 'short', hour: '2-digit', minute:'2-digit' }) };
                setMembers(updatedMembers); setTransactions([newTrx, ...transactions]); closeModal();
            };

            // --- LOGIC HAPUS & EDIT TRANSAKSI ---
            const handleDeleteTransaction = (id) => {
                if(!window.confirm("Hapus transaksi ini? Poin member akan dikembalikan ke kondisi sebelumnya.")) return;
                
                const trx = transactions.find(t => t.id === id);
                if (!trx) return;

                const updatedMembers = members.map(m => {
                    if (m.id === trx.memberId) {
                        if (trx.type === 'EARN') {
                            return { ...m, points: Math.max(0, m.points - trx.points) };
                        } else {
                            return { ...m, points: m.points + trx.points };
                        }
                    }
                    return m;
                });

                setMembers(updatedMembers);
                setTransactions(transactions.filter(t => t.id !== id));
            };

            const startEditTransaction = (trx) => {
                setEditingTransaction(trx);
                setTrxAmount(trx.amount ? new Intl.NumberFormat('id-ID').format(trx.amount) : '');
                setTrxProfit(trx.profit ? new Intl.NumberFormat('id-ID').format(trx.profit) : '');
                setTrxDescription(trx.description || 'Lainnya');
                setRedeemNote(trx.note || '');
            };

            const saveEditTransaction = (e) => {
                e.preventDefault();
                const updatedTrx = {
                    ...editingTransaction,
                    amount: trxAmount ? parseInt(trxAmount.replace(/\./g, ''), 10) : 0,
                    profit: trxProfit ? parseInt(trxProfit.replace(/\./g, ''), 10) : 0,
                    description: trxDescription,
                    note: redeemNote
                };
                
                setTransactions(transactions.map(t => t.id === editingTransaction.id ? updatedTrx : t));
                setEditingTransaction(null);
                setTrxAmount('');
                setTrxProfit('');
                setTrxDescription('');
                setRedeemNote('');
            };

            // --- LOGIC EDIT KATALOG ---
            const startEditReward = (reward) => {
                setEditingReward(reward);
                setEditRewardName(reward.name);
                setEditRewardPoints(reward.points);
                setEditRewardImage(reward.imageData);
            };

            const handleEditRewardImage = (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 2000000) { alert("Ukuran gambar max 2MB!"); return; }
                    const reader = new FileReader();
                    reader.onloadend = () => setEditRewardImage(reader.result);
                    reader.readAsDataURL(file);
                }
            };

            const saveEditReward = (e) => {
                e.preventDefault();
                const updatedReward = {
                    ...editingReward,
                    name: editRewardName,
                    points: parseInt(editRewardPoints),
                    imageType: editRewardImage ? 'custom' : 'icon',
                    imageData: editRewardImage
                };
                setRewards(rewards.map(r => r.id === editingReward.id ? updatedReward : r));
                setEditingReward(null);
                setEditRewardName('');
                setEditRewardPoints('');
                setEditRewardImage(null);
            };

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 2000000) { alert("Ukuran gambar max 2MB!"); return; }
                    const reader = new FileReader();
                    reader.onloadend = () => setNewRewardImage(reader.result);
                    reader.readAsDataURL(file);
                }
            };

            const handleAddReward = (e) => {
                e.preventDefault();
                if (!newRewardName || !newRewardPoints) return;
                const newItem = { id: Date.now(), name: newRewardName, points: parseInt(newRewardPoints), imageType: newRewardImage ? 'custom' : 'icon', imageData: newRewardImage };
                setRewards([newItem, ...rewards]); setNewRewardName(''); setNewRewardPoints(''); setNewRewardImage(null); if (fileInputRef.current) fileInputRef.current.value = "";
            };

            const handleUpdateImage = (id, file) => {
                if (file) {
                    if (file.size > 2000000) { alert("Ukuran gambar max 2MB!"); return; }
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        const updatedRewards = rewards.map(r => r.id === id ? { ...r, imageType: 'custom', imageData: reader.result } : r);
                        setRewards(updatedRewards);
                    };
                    reader.readAsDataURL(file);
                }
            };

            const handleDeleteReward = (id) => { if(window.confirm("Hapus hadiah?")) setRewards(rewards.filter(r => r.id !== id)); };
            const selectReward = (reward) => { if (selectedMember.points < reward.points) return alert(`Poin kurang! Butuh ${reward.points}.`); setRedeemNote(reward.name); setPointInput(reward.points); };
            const deleteMember = (id) => { if(window.confirm("Hapus member?")) setMembers(members.filter(m => m.id !== id)); };
            const formatRupiah = (number) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(number);
            
            const handleAmountChange = (e) => { 
                const rawValue = e.target.value.replace(/\D/g, ''); 
                setTrxAmount(rawValue ? new Intl.NumberFormat('id-ID').format(rawValue) : ''); 
            };
            
            const handleProfitChange = (e) => {
                const rawValue = e.target.value.replace(/\D/g, '');
                setTrxProfit(rawValue ? new Intl.NumberFormat('id-ID').format(rawValue) : '');
            };

            const openModal = (member, type) => { 
                setSelectedMember(member); 
                setModalType(type); 
                setTrxAmount(''); 
                setTrxProfit(''); 
                setTrxDescription('Transfer Sesama BRI'); 
                setPointInput(''); 
                setRedeemNote(''); 
            };
            const closeModal = () => { setSelectedMember(null); setModalType(null); };

            // Calculate Total Profit
            const totalProfit = transactions.reduce((sum, t) => sum + (t.profit || 0), 0);

            // --- RENDER ---
            if (isLoading) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-slate-50 flex-col gap-4">
                        <div className="loader"></div>
                        <p className="text-slate-500 font-bold animate-pulse">Memuat Database...</p>
                    </div>
                );
            }

            return (
                <div className="min-h-screen flex justify-center bg-gray-100">
                    {/* CONTAINER UTAMA RESPONSIVE */}
                    <div className="w-full md:max-w-6xl bg-slate-50 min-h-screen shadow-2xl relative flex flex-col md:my-0 md:rounded-none">
                        
                        {/* HEADER RESPONSIVE */}
                        <header className={`sticky top-0 z-30 ${isAdmin ? 'bg-gradient-to-r from-blue-700 to-blue-500' : 'bg-gradient-to-r from-violet-600 to-indigo-600'} rounded-b-[2rem] md:rounded-none shadow-xl overflow-hidden transition-all duration-500`}>
                            <div className="absolute top-0 right-0 w-40 h-40 bg-white opacity-10 rounded-full -mr-16 -mt-16 blur-2xl pointer-events-none"></div>
                            <div className="absolute bottom-0 left-0 w-24 h-24 bg-yellow-400 opacity-20 rounded-full -ml-8 -mb-8 blur-3xl pointer-events-none"></div>
                            
                            <div className="px-6 md:px-10 pt-12 md:pt-6 pb-8 md:pb-6 text-white relative z-10 flex flex-col md:flex-row justify-between items-center gap-4">
                                <div className="text-center md:text-left">
                                    <h1 className="text-2xl md:text-3xl font-black tracking-tight flex items-center gap-2 drop-shadow-md justify-center md:justify-start">
                                        {isAdmin ? <Icons.Wallet size={28} /> : <Icons.Award size={28} className="text-yellow-300" />}
                                        {isAdmin ? (
                                            <span>
                                                AGEN BRI<span className="text-orange-400">LINK</span>
                                            </span>
                                        ) : 'MY POINTS'}
                                    </h1>
                                    <p className="text-white/80 text-xs font-bold tracking-wider mt-1 uppercase">{isAdmin ? 'Dashboard Admin' : 'Loyalty Member App'}</p>
                                </div>
                                
                                {/* DESKTOP NAVIGATION */}
                                {isAdmin && (
                                    <div className="hidden md:flex gap-2">
                                        <DesktopNavBtn active={view === 'dashboard'} onClick={() => setView('dashboard')} icon={(active) => <Icons.Wallet size={20} />} label="Home" />
                                        <DesktopNavBtn active={view === 'members' || view === 'addMember'} onClick={() => setView('members')} icon={(active) => <Icons.Users size={20} />} label="Member" />
                                        <DesktopNavBtn active={view === 'rewards'} onClick={() => setView('rewards')} icon={(active) => <Icons.Gift size={20} />} label="Hadiah" />
                                        <DesktopNavBtn active={view === 'history'} onClick={() => setView('history')} icon={(active) => <Icons.History size={20} />} label="Riwayat" />
                                    </div>
                                )}

                                <div>
                                    {isAdmin ? (
                                        <button onClick={handleLogout} className="bg-white/10 backdrop-blur-md border border-white/20 text-xs px-4 py-2 rounded-full font-bold shadow-sm flex items-center gap-2 hover:bg-red-500 hover:border-red-500 transition"><Icons.LogOut size={14} /> KELUAR</button>
                                    ) : (
                                        <button onClick={() => setShowPinModal(true)} className="bg-white/10 backdrop-blur-md border border-white/20 text-xs px-4 py-2 rounded-full font-bold shadow-sm flex items-center gap-2 hover:bg-white/30 transition"><Icons.Lock size={14} /> ADMIN</button>
                                    )}
                                </div>
                            </div>
                        </header>

                        {!isAdmin && (
                            <main className="flex-1 px-5 md:px-10 -mt-4 relative z-20 pb-10 overflow-y-auto no-scrollbar">
                                <div className="max-w-2xl mx-auto">
                                    <div className="bg-white/90 backdrop-blur-xl p-6 md:p-8 rounded-3xl shadow-[0_10px_40px_-10px_rgba(0,0,0,0.1)] border border-white animate-fade-in-up">
                                        <h2 className="text-center font-black text-slate-800 text-xl md:text-2xl mb-2">Cek Poin Anda</h2>
                                        <p className="text-center text-slate-500 text-sm mb-6 font-medium">Masukkan nomor HP untuk melihat reward.</p>
                                        <form onSubmit={handlePublicSearch} className="space-y-4">
                                            <div className="relative group">
                                                <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"><Icons.Smartphone size={24} className="text-slate-400 group-focus-within:text-violet-500 transition-colors" /></div>
                                                <input type="number" value={searchPhone} onChange={(e) => setSearchPhone(e.target.value)} className="w-full pl-12 pr-4 py-4 md:py-5 bg-slate-50 border-2 border-transparent focus:bg-white rounded-2xl font-bold text-lg md:text-xl text-slate-800 focus:border-violet-500 outline-none transition-all shadow-inner" placeholder="08xxxxxxxxxx" required />
                                            </div>
                                            <button type="submit" className="w-full bg-gradient-to-r from-violet-600 to-indigo-600 text-white py-4 md:py-5 rounded-2xl font-bold text-lg shadow-lg shadow-indigo-500/30 flex justify-center items-center gap-2 hover:scale-[1.01] transition-transform active:scale-[0.98]"><Icons.Search size={22} /> LIHAT POIN</button>
                                        </form>
                                    </div>

                                    {hasSearched && (
                                        <div className="mt-8 animate-fade-in-up">
                                            {searchResult ? (
                                                <div className="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 rounded-3xl p-1 shadow-2xl relative overflow-hidden group max-w-md mx-auto">
                                                    <div className="absolute inset-0 bg-gradient-to-r from-transparent via-yellow-400/20 to-transparent translate-x-[-100%] animate-[shimmer_2s_infinite]"></div>
                                                    <div className="bg-slate-900/50 backdrop-blur-sm rounded-[1.3rem] p-8 text-white relative h-full border border-white/10">
                                                        <div className="flex justify-between items-start mb-8">
                                                            <div><p className="text-slate-400 text-xs font-bold tracking-widest uppercase mb-1">Member Name</p><h3 className="font-bold text-2xl tracking-wide">{searchResult.name}</h3></div>
                                                            <Icons.Award size={40} className="text-yellow-400 drop-shadow-[0_0_10px_rgba(250,204,21,0.5)]" />
                                                        </div>
                                                        <div className="flex items-end gap-2 mb-10"><div className="text-6xl font-black bg-clip-text text-transparent bg-gradient-to-b from-white to-slate-400">{searchResult.points}</div><div className="text-lg font-bold text-yellow-400 mb-2">POIN</div></div>
                                                        <div className="flex justify-between items-center border-t border-white/10 pt-4"><p className="text-slate-400 text-sm">{searchResult.phone}</p><div className="text-xs font-bold bg-yellow-400 text-slate-900 px-3 py-1 rounded-lg">GOLD MEMBER</div></div>
                                                    </div>
                                                </div>
                                            ) : (
                                                <div className="bg-red-50 border border-red-100 rounded-3xl p-6 text-center animate-shake max-w-md mx-auto"><div className="w-14 h-14 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-3 text-red-500 shadow-sm"><Icons.X size={28} /></div><h3 className="font-bold text-red-600 text-lg">Nomor Tidak Ditemukan</h3><p className="text-red-400 text-sm mt-1">Pastikan nomor HP sudah benar.</p></div>
                                            )}
                                        </div>
                                    )}
                                </div>

                                <div className="mt-12">
                                    <div className="flex items-center justify-between px-1 mb-6"><h3 className="font-bold text-slate-800 text-xl flex items-center gap-2"><Icons.Gift size={24} className="text-violet-500" /> Katalog Hadiah</h3><span className="text-xs font-bold text-violet-500 bg-violet-50 px-3 py-1.5 rounded-lg">Terbaru</span></div>
                                    
                                    {/* RESPONSIVE GRID FOR REWARDS (LIMITED TO 8 INITIALLY) */}
                                    <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 pb-6">
                                        {rewards.slice(0, visibleRewards).map(reward => (
                                            <div key={reward.id} className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden flex flex-col group hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
                                                <div className="h-40 md:h-48 bg-slate-100 flex items-center justify-center relative overflow-hidden">
                                                    {reward.imageType === 'custom' && reward.imageData ? (
                                                        <img src={reward.imageData} alt={reward.name} className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" />
                                                    ) : (
                                                        <div className="flex flex-col items-center justify-center text-slate-300"><Icons.Image size={40} className="mb-1 opacity-50" /><span className="text-[10px] font-bold uppercase">No Image</span></div>
                                                    )}
                                                    <div className="absolute top-3 right-3 bg-slate-900/80 backdrop-blur-md text-white text-xs font-bold px-3 py-1.5 rounded-lg shadow-sm">{reward.points} Poin</div>
                                                </div>
                                                <div className="p-4 md:p-5"><p className="font-bold text-base text-slate-800 line-clamp-2 leading-tight mb-2">{reward.name}</p><p className="text-xs text-slate-400">Tukarkan di agen</p></div>
                                            </div>
                                        ))}
                                    </div>

                                    {/* TOMBOL LOAD MORE (Hanya muncul jika item > 8) */}
                                    {rewards.length > visibleRewards && (
                                        <div className="text-center pb-24">
                                            <button onClick={() => setVisibleRewards(prev => prev + 8)} className="px-6 py-3 bg-white border border-slate-200 text-blue-600 font-bold rounded-full shadow-sm hover:bg-blue-50 transition">
                                                Lihat Lebih Banyak
                                            </button>
                                        </div>
                                    )}
                                    {rewards.length <= visibleRewards && <div className="pb-24"></div>}
                                </div>
                            </main>
                        )}

                        {isAdmin && (
                            <main className="flex-1 px-5 md:px-10 -mt-2 relative z-20 pb-28 md:pb-10 overflow-y-auto no-scrollbar">
                                {view === 'dashboard' && (
                                    <div className="space-y-6 animate-fade-in-up">
                                        <div className="bg-blue-50 border border-blue-100 p-5 rounded-3xl flex items-start gap-4 max-w-4xl mx-auto"><div className="bg-blue-100 text-blue-600 p-3 rounded-xl"><Icons.Lock size={24} /></div><div><h3 className="font-bold text-blue-800 text-lg">Mode Aman Aktif</h3><p className="text-sm text-blue-600 mt-1 leading-relaxed">Jangan lupa <b>KELUAR</b> sebelum memberikan perangkat ke orang lain.</p></div></div>
                                        
                                        {/* RESPONSIVE STATS GRID - Updated Layout for 4 items */}
                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6">
                                            <div className="bg-white p-5 rounded-3xl shadow-sm flex flex-col justify-between h-36 md:h-40 relative overflow-hidden"><div className="relative z-10"><div className="text-blue-600 bg-blue-50 w-10 h-10 rounded-xl flex items-center justify-center mb-3"><Icons.Users size={20} /></div><span className="text-slate-400 text-[10px] font-bold uppercase tracking-widest">Member</span></div><p className="text-3xl font-black text-slate-800 relative z-10 tracking-tight">{members.length}</p></div>
                                            <div className="bg-white p-5 rounded-3xl shadow-sm flex flex-col justify-between h-36 md:h-40 relative overflow-hidden"><div className="relative z-10"><div className="text-orange-600 bg-orange-50 w-10 h-10 rounded-xl flex items-center justify-center mb-3"><Icons.Gift size={20} /></div><span className="text-slate-400 text-[10px] font-bold uppercase tracking-widest">Hadiah</span></div><p className="text-3xl font-black text-slate-800 relative z-10 tracking-tight">{rewards.length}</p></div>
                                            <div className="bg-white p-5 rounded-3xl shadow-sm flex flex-col justify-between h-36 md:h-40 relative overflow-hidden"><div className="relative z-10"><div className="text-green-600 bg-green-50 w-10 h-10 rounded-xl flex items-center justify-center mb-3"><Icons.TrendingUp size={20} /></div><span className="text-slate-400 text-[10px] font-bold uppercase tracking-widest">Transaksi</span></div><p className="text-3xl font-black text-slate-800 relative z-10 tracking-tight">{transactions.length}</p></div>
                                            {/* NEW: PROFIT CARD */}
                                            <div className="bg-gradient-to-br from-slate-800 to-slate-900 p-5 rounded-3xl shadow-lg flex flex-col justify-between h-36 md:h-40 relative overflow-hidden text-white"><div className="relative z-10"><div className="text-yellow-400 bg-white/10 w-10 h-10 rounded-xl flex items-center justify-center mb-3 backdrop-blur-sm"><Icons.BarChart size={20} /></div><span className="text-white/60 text-[10px] font-bold uppercase tracking-widest">Total Keuntungan</span></div><p className="text-2xl font-black text-white relative z-10 tracking-tight truncate">{formatRupiah(totalProfit)}</p></div>
                                        </div>

                                        <div className="pt-4"><h3 className="text-sm font-bold text-slate-400 uppercase tracking-wider mb-4 ml-1">Manajemen Data</h3><div className="bg-white rounded-3xl p-3 shadow-sm border border-slate-100 grid grid-cols-2 md:grid-cols-3 gap-3">
                                            <button onClick={handleBackup} className="flex flex-col items-center justify-center p-6 rounded-2xl bg-slate-50 hover:bg-slate-100 transition gap-2 group"><Icons.Download size={28} className="text-green-600 group-hover:scale-110 transition-transform" /><span className="text-sm font-bold text-slate-600">Backup Data</span></button>
                                            <label className="flex flex-col items-center justify-center p-6 rounded-2xl bg-slate-50 hover:bg-slate-100 transition gap-2 cursor-pointer relative group"><Icons.Upload size={28} className="text-blue-600 group-hover:scale-110 transition-transform" /><span className="text-sm font-bold text-slate-600">Restore Data</span><input type="file" ref={restoreInputRef} onChange={handleRestore} accept=".json" className="absolute inset-0 opacity-0 cursor-pointer" /></label>
                                            <button onClick={handleResetData} className="col-span-2 md:col-span-1 flex flex-col md:flex-row items-center justify-center p-6 rounded-2xl bg-red-50 hover:bg-red-100 transition gap-2 text-red-600 group"><Icons.Trash2 size={28} className="group-hover:scale-110 transition-transform" /><span className="text-sm font-bold">Reset Semua</span></button>
                                        </div></div>
                                        
                                        <div className="space-y-4 mt-6 md:grid md:grid-cols-2 md:gap-4 md:space-y-0">
                                            <button onClick={() => setView('addMember')} className="w-full bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white p-5 rounded-3xl shadow-lg shadow-blue-600/20 flex items-center justify-between group transition-all"><div className="flex items-center gap-4"><div className="bg-white/20 p-3 rounded-2xl"><Icons.PlusCircle size={28} /></div><div className="text-left"><p className="font-bold text-xl leading-tight">Member Baru</p></div></div><Icons.ChevronRight className="opacity-70 group-hover:translate-x-1 transition-transform" size={24} /></button>
                                            <button onClick={() => setView('rewards')} className="w-full bg-white hover:bg-slate-50 active:bg-slate-100 text-slate-700 p-5 rounded-3xl shadow-sm border border-slate-100 flex items-center justify-between group transition-all"><div className="flex items-center gap-4"><div className="bg-orange-100 text-orange-600 p-3 rounded-2xl"><Icons.Gift size={28} /></div><div className="text-left"><p className="font-bold text-xl leading-tight">Katalog Hadiah</p></div></div><Icons.ChevronRight className="opacity-40 group-hover:translate-x-1 transition-transform" size={24} /></button>
                                        </div>
                                    </div>
                                )}

                                {view === 'addMember' && (
                                    <div className="max-w-xl mx-auto bg-white p-8 rounded-3xl shadow-lg border border-slate-100 animate-fade-in-up mt-4">
                                        <h2 className="text-2xl font-bold mb-8 text-slate-800 flex items-center gap-3"><Icons.PlusCircle size={28} className="text-blue-600" /> Tambah Member</h2>
                                        <form onSubmit={handleAddMember} className="space-y-6">
                                            <div className="space-y-2"><label className="text-xs font-bold text-slate-400 uppercase tracking-wider ml-1">Nama Lengkap</label><input type="text" value={newMemberName} onChange={(e) => setNewMemberName(e.target.value)} className="w-full p-5 bg-slate-50 border-none rounded-2xl focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all outline-none font-bold text-slate-700 text-lg" placeholder="Nama Pelanggan" /></div>
                                            <div className="space-y-2"><label className="text-xs font-bold text-slate-400 uppercase tracking-wider ml-1">Nomor HP</label><input type="number" value={newMemberPhone} onChange={(e) => setNewMemberPhone(e.target.value)} className="w-full p-5 bg-slate-50 border-none rounded-2xl focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all outline-none font-bold text-slate-700 text-lg" placeholder="08xxxxxxxx" /></div>
                                            <div className="flex gap-4 pt-4"><button type="button" onClick={() => setView('dashboard')} className="flex-1 bg-slate-100 text-slate-500 py-5 rounded-2xl font-bold hover:bg-slate-200 transition text-sm">Batal</button><button type="submit" className="flex-1 bg-blue-600 text-white py-5 rounded-2xl font-bold hover:bg-blue-700 shadow-lg shadow-blue-500/30 transition transform active:scale-95 text-sm">Simpan Data</button></div>
                                        </form>
                                    </div>
                                )}

                                {view === 'rewards' && (
                                    <div className="space-y-8 animate-fade-in-up mt-4">
                                        <div className="bg-white p-6 md:p-8 rounded-3xl shadow-sm border border-slate-100 max-w-3xl mx-auto">
                                            <h2 className="text-sm font-bold text-slate-400 uppercase tracking-wide mb-6 flex items-center gap-2"><Icons.Plus size={18} className="text-orange-500" /> Tambah Hadiah Baru</h2>
                                            <form onSubmit={handleAddReward} className="flex flex-col gap-4">
                                                <input type="text" value={newRewardName} onChange={(e) => setNewRewardName(e.target.value)} className="w-full p-5 bg-slate-50 border-none rounded-2xl text-base font-medium focus:ring-2 focus:ring-orange-500 outline-none" placeholder="Nama Barang" required />
                                                <div className="flex gap-4">
                                                    <input type="number" value={newRewardPoints} onChange={(e) => setNewRewardPoints(e.target.value)} className="flex-1 p-5 bg-slate-50 border-none rounded-2xl text-base font-medium focus:ring-2 focus:ring-orange-500 outline-none" placeholder="Poin" required />
                                                    <div className="relative w-20 flex-shrink-0"><input type="file" ref={fileInputRef} accept="image/*" onChange={handleImageUpload} className="absolute inset-0 w-full h-full opacity-0 z-10 cursor-pointer" /><div className={`w-full h-full rounded-2xl flex items-center justify-center border-2 ${newRewardImage ? 'border-green-500 bg-green-50 text-green-600' : 'border-slate-200 bg-slate-50 text-slate-400'}`}>{newRewardImage ? <Icons.Image size={24} /> : <Icons.Upload size={24} />}</div></div>
                                                </div>
                                                <button type="submit" className="bg-orange-500 hover:bg-orange-600 text-white w-full py-5 rounded-2xl font-bold shadow-lg shadow-orange-500/20 transition active:scale-95 flex items-center justify-center gap-2"><Icons.Save size={20} /> Simpan</button>
                                            </form>
                                        </div>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 pb-12">
                                            {rewards.map(reward => (
                                                <div key={reward.id} className="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex justify-between items-center group hover:shadow-md transition-shadow">
                                                    <div className="flex items-center gap-4">
                                                        {/* EDITABLE IMAGE WRAPPER */}
                                                        <label className="relative cursor-pointer group/image">
                                                            <input type="file" accept="image/*" className="hidden" onChange={(e) => handleUpdateImage(reward.id, e.target.files[0])} />
                                                            <div className="bg-slate-100 h-16 w-16 rounded-xl flex items-center justify-center overflow-hidden flex-shrink-0 border border-slate-200 relative">
                                                                {reward.imageType === 'custom' && reward.imageData ? (
                                                                    <img src={reward.imageData} className="w-full h-full object-cover" alt={reward.name} />
                                                                ) : (
                                                                    <Icons.Gift size={28} className="text-orange-500" />
                                                                )}
                                                                {/* Hover Overlay for Edit Hint */}
                                                                <div className="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover/image:opacity-100 transition-opacity">
                                                                    <Icons.Edit size={16} className="text-white" />
                                                                </div>
                                                            </div>
                                                        </label>
                                                        <div className="min-w-0">
                                                            <p className="font-bold text-slate-800 text-base truncate">{reward.name}</p>
                                                            <p className="text-sm font-bold text-orange-600 bg-orange-100 inline-block px-3 py-1 rounded-lg mt-1">{reward.points} Poin</p>
                                                        </div>
                                                    </div>
                                                    {/* ACTION BUTTONS (EDIT & DELETE) */}
                                                    <div className="flex gap-2">
                                                        <button onClick={() => startEditReward(reward)} className="text-blue-300 hover:text-blue-500 active:text-blue-600 transition-colors p-2"><Icons.Edit size={24} /></button>
                                                        <button onClick={() => handleDeleteReward(reward.id)} className="text-slate-300 hover:text-red-500 active:text-red-600 transition-colors p-2"><Icons.Trash2 size={24} /></button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {view === 'members' && (
                                    <div className="space-y-6 animate-fade-in-up mt-4 pb-12">
                                        <div className="flex flex-col md:flex-row md:items-center justify-between px-1 gap-4">
                                            <div>
                                                <h2 className="text-lg font-bold text-slate-400 uppercase tracking-wide">Daftar Member</h2>
                                                <span className="text-sm font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded-lg">{members.length} Total</span>
                                            </div>
                                            {/* ADMIN SEARCH BAR */}
                                            <div className="relative w-full md:w-64">
                                                <input type="text" placeholder="Cari Nama / No HP..." value={searchTermAdmin} onChange={(e) => { setSearchTermAdmin(e.target.value); setCurrentPage(1); }} className="w-full pl-10 pr-4 py-3 rounded-xl border border-slate-200 bg-white focus:border-blue-500 focus:ring-2 focus:ring-blue-100 outline-none transition text-sm font-bold" />
                                                <Icons.Search size={18} className="absolute left-3 top-3.5 text-slate-400" />
                                            </div>
                                        </div>

                                        {(() => {
                                            // LOGIC FILTER & PAGINATION
                                            const filteredMembers = members.filter(member => 
                                                member.name.toLowerCase().includes(searchTermAdmin.toLowerCase()) || 
                                                member.phone.includes(searchTermAdmin)
                                            );
                                            const indexOfLastMember = currentPage * membersPerPage;
                                            const indexOfFirstMember = indexOfLastMember - membersPerPage;
                                            const currentMembers = filteredMembers.slice(indexOfFirstMember, indexOfLastMember);
                                            const totalPages = Math.ceil(filteredMembers.length / membersPerPage);

                                            return (
                                                <>
                                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                                        {currentMembers.length > 0 ? currentMembers.map(member => (
                                                            <div key={member.id} className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 flex flex-col gap-5 relative overflow-hidden transition-all hover:shadow-md"><div className="flex justify-between items-start relative z-10"><div className="flex gap-4"><div className="w-14 h-14 rounded-2xl bg-gradient-to-br from-blue-100 to-white border border-white shadow-sm flex items-center justify-center text-blue-600 font-bold text-2xl">{member.name.charAt(0).toUpperCase()}</div><div><h3 className="font-bold text-slate-800 text-xl leading-tight">{member.name}</h3><p className="text-sm text-slate-400 font-medium mt-1">{member.phone}</p></div></div><div className="text-right"><span className="block text-3xl font-black text-blue-600">{member.points}</span><span className="text-xs text-slate-400 uppercase font-bold tracking-wider">Poin</span></div></div><div className="grid grid-cols-2 gap-4 relative z-10 mt-1"><button onClick={() => openModal(member, 'transaction')} className="bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-xl text-sm font-bold shadow-lg shadow-blue-200 active:bg-blue-800 transition flex items-center justify-center gap-2"><Icons.PlusCircle size={18} /> Tambah</button><div className="flex gap-3"><button onClick={() => openModal(member, 'redeem')} className="flex-1 bg-white hover:bg-orange-50 text-orange-600 border border-orange-200 py-4 rounded-xl text-sm font-bold active:bg-orange-100 transition flex items-center justify-center gap-2"><Icons.Gift size={18} /> Tukar</button><button onClick={() => deleteMember(member.id)} className="w-14 bg-red-50 hover:bg-red-100 text-red-400 rounded-xl flex items-center justify-center active:bg-red-200 transition border border-red-50"><Icons.Trash2 size={20} /></button></div></div></div>
                                                        )) : (
                                                            <div className="col-span-full text-center py-10 text-slate-400 font-medium">Tidak ada member ditemukan.</div>
                                                        )}
                                                    </div>

                                                    {/* PAGINATION CONTROLS */}
                                                    {filteredMembers.length > membersPerPage && (
                                                        <div className="flex justify-center items-center gap-4 mt-8">
                                                            <button onClick={() => setCurrentPage(prev => Math.max(prev - 1, 1))} disabled={currentPage === 1} className={`px-4 py-2 rounded-xl font-bold transition ${currentPage === 1 ? 'bg-slate-100 text-slate-300 cursor-not-allowed' : 'bg-white border border-slate-200 text-blue-600 hover:bg-blue-50 shadow-sm'}`}>Sebelumnya</button>
                                                            <span className="text-xs font-bold text-slate-400 uppercase tracking-widest">Hal {currentPage} / {totalPages}</span>
                                                            <button onClick={() => setCurrentPage(prev => Math.min(prev + 1, totalPages))} disabled={currentPage === totalPages} className={`px-4 py-2 rounded-xl font-bold transition ${currentPage === totalPages ? 'bg-slate-100 text-slate-300 cursor-not-allowed' : 'bg-white border border-slate-200 text-blue-600 hover:bg-blue-50 shadow-sm'}`}>Selanjutnya</button>
                                                        </div>
                                                    )}
                                                </>
                                            );
                                        })()}
                                        
                                        {/* Floating Button hanya di Mobile untuk Admin */}
                                        <button onClick={() => setView('addMember')} className="md:hidden fixed bottom-24 right-6 bg-gradient-to-tr from-blue-600 to-blue-500 text-white p-4 rounded-2xl shadow-2xl shadow-blue-500/40 hover:scale-105 active:scale-90 transition-transform z-20"><Icons.Plus size={28} strokeWidth={3} /></button>
                                    </div>
                                )}

                                {view === 'history' && (
                                    <div className="space-y-4 animate-fade-in-up mt-4 pb-12">
                                        <div className="flex flex-col md:flex-row md:items-center justify-between px-1 gap-4">
                                            <h2 className="text-lg font-bold text-slate-400 uppercase tracking-wide">Riwayat Transaksi</h2>
                                            {/* SEARCH HISTORY BAR */}
                                            <div className="relative w-full md:w-64">
                                                <input type="text" placeholder="Cari Nama Member..." value={searchHistory} onChange={(e) => { setSearchHistory(e.target.value); setCurrentHistoryPage(1); }} className="w-full pl-10 pr-4 py-3 rounded-xl border border-slate-200 bg-white focus:border-blue-500 focus:ring-2 focus:ring-blue-100 outline-none transition text-sm font-bold" />
                                                <Icons.Search size={18} className="absolute left-3 top-3.5 text-slate-400" />
                                            </div>
                                        </div>

                                        <div className="bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden">
                                            {(() => {
                                                // FILTER & PAGINATION HISTORY LOGIC
                                                const filteredTransactions = transactions.filter(trx => 
                                                    trx.memberName.toLowerCase().includes(searchHistory.toLowerCase())
                                                );
                                                const indexOfLastHistory = currentHistoryPage * historyPerPage;
                                                const indexOfFirstHistory = indexOfLastHistory - historyPerPage;
                                                const currentHistory = filteredTransactions.slice(indexOfFirstHistory, indexOfLastHistory);
                                                const totalHistoryPages = Math.ceil(filteredTransactions.length / historyPerPage);

                                                return (
                                                    <>
                                                        {currentHistory.length > 0 ? currentHistory.map((trx, index) => (
                                                            <div key={trx.id} className={`p-5 border-b border-slate-50 last:border-0 flex justify-between items-center hover:bg-slate-50 transition-colors ${index % 2 === 0 ? 'bg-white' : 'bg-slate-50/30'}`}>
                                                                <div className="flex gap-4 items-center">
                                                                    <div className={`p-3 rounded-2xl ${trx.type === 'EARN' ? 'bg-green-50 text-green-600' : 'bg-red-50 text-red-500'}`}>{trx.type === 'EARN' ? <Icons.TrendingUp size={24} /> : <Icons.Gift size={24} />}</div>
                                                                    <div>
                                                                        <p className="font-bold text-slate-800 text-base">{trx.memberName}</p>
                                                                        <div className="flex flex-col mt-1">
                                                                            <div className="flex flex-wrap items-center gap-2">
                                                                                <span className="text-xs text-slate-400 font-medium">{trx.date}</span>
                                                                                {/* Menampilkan Jenis Transaksi di Riwayat */}
                                                                                {trx.type === 'EARN' && trx.description && (
                                                                                    <span className="text-[10px] text-blue-600 font-bold bg-blue-50 px-2 py-0.5 rounded border border-blue-100">{trx.description}</span>
                                                                                )}
                                                                            </div>
                                                                            {trx.type === 'EARN' && (
                                                                                <div className="flex gap-2 mt-1">
                                                                                    <span className="text-[10px] text-slate-500 font-bold bg-slate-100 px-2 py-0.5 rounded">Rp {formatRupiah(trx.amount)}</span>
                                                                                    {trx.profit > 0 && <span className="text-[10px] text-green-600 font-bold bg-green-50 px-2 py-0.5 rounded">Laba: {formatRupiah(trx.profit)}</span>}
                                                                                </div>
                                                                            )}
                                                                            {trx.type === 'REDEEM' && <span className="text-xs text-orange-500 font-bold mt-1 block">Menukar: {trx.note}</span>}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div className="flex flex-col items-end gap-2">
                                                                    <div className={`font-black text-lg ${trx.type === 'EARN' ? 'text-green-600' : 'text-red-500'}`}>{trx.type === 'EARN' ? '+' : '-'}{trx.points}</div>
                                                                    {/* TOMBOL EDIT & HAPUS */}
                                                                    <div className="flex gap-2">
                                                                        <button onClick={() => startEditTransaction(trx)} className="p-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition"><Icons.Edit size={16} /></button>
                                                                        <button onClick={() => handleDeleteTransaction(trx.id)} className="p-2 bg-red-50 text-red-500 rounded-lg hover:bg-red-100 transition"><Icons.Trash2 size={16} /></button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        )) : (
                                                            <div className="p-10 text-center text-slate-400">Tidak ada riwayat transaksi.</div>
                                                        )}

                                                        {/* HISTORY PAGINATION CONTROLS */}
                                                        {filteredTransactions.length > historyPerPage && (
                                                            <div className="flex justify-center items-center gap-4 p-6 border-t border-slate-50">
                                                                <button onClick={() => setCurrentHistoryPage(prev => Math.max(prev - 1, 1))} disabled={currentHistoryPage === 1} className={`px-4 py-2 rounded-xl font-bold transition ${currentHistoryPage === 1 ? 'bg-slate-100 text-slate-300 cursor-not-allowed' : 'bg-white border border-slate-200 text-blue-600 hover:bg-blue-50 shadow-sm'}`}>Sebelumnya</button>
                                                                <span className="text-xs font-bold text-slate-400 uppercase tracking-widest">Hal {currentHistoryPage} / {totalHistoryPages}</span>
                                                                <button onClick={() => setCurrentHistoryPage(prev => Math.min(prev + 1, totalHistoryPages))} disabled={currentHistoryPage === totalHistoryPages} className={`px-4 py-2 rounded-xl font-bold transition ${currentHistoryPage === totalHistoryPages ? 'bg-slate-100 text-slate-300 cursor-not-allowed' : 'bg-white border border-slate-200 text-blue-600 hover:bg-blue-50 shadow-sm'}`}>Selanjutnya</button>
                                                            </div>
                                                        )}
                                                    </>
                                                );
                                            })()}
                                        </div>
                                    </div>
                                )}
                            </main>
                        )}

                        {showPinModal && (
                            <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/80 backdrop-blur-sm animate-fade-in p-6">
                                <div className="bg-white w-full rounded-3xl p-8 shadow-2xl animate-scale-up max-w-sm">
                                    <div className="text-center mb-8"><div className="w-20 h-20 bg-blue-100 rounded-full mx-auto flex items-center justify-center text-blue-600 mb-6"><Icons.Lock size={40} /></div><h3 className="font-bold text-2xl text-slate-800">Login Agen</h3></div>
                                    <form onSubmit={handleLogin} className="space-y-6"><input type="password" value={pinInput} onChange={(e) => setPinInput(e.target.value)} className="w-full text-center text-4xl font-black tracking-widest p-5 bg-slate-50 rounded-2xl border-2 border-slate-100 focus:border-blue-500 outline-none" placeholder="••••••" autoFocus maxLength={6} /><div className="flex gap-4"><button type="button" onClick={() => setShowPinModal(false)} className="flex-1 py-5 font-bold text-slate-500 bg-slate-100 rounded-2xl hover:bg-slate-200 transition">Batal</button><button type="submit" className="flex-1 py-5 font-bold text-white bg-blue-600 rounded-2xl hover:bg-blue-700 shadow-lg shadow-blue-600/30 transition">Masuk</button></div></form>
                                    <p className="text-center text-xs text-slate-300 mt-8">PIN Default: 709999</p>
                                </div>
                            </div>
                        )}

                        {/* MODAL EDIT KATALOG (NEW) */}
                        {isAdmin && editingReward && (
                            <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 backdrop-blur-sm animate-fade-in p-4">
                                <div className="bg-white w-full max-w-md rounded-3xl p-8 shadow-2xl animate-scale-up">
                                    <div className="flex justify-between items-center mb-6">
                                        <h3 className="font-bold text-xl text-slate-800">Edit Katalog</h3>
                                        <button onClick={() => setEditingReward(null)} className="bg-slate-100 p-2 rounded-full hover:bg-slate-200 transition"><Icons.X size={20} /></button>
                                    </div>
                                    <form onSubmit={saveEditReward} className="flex flex-col gap-4">
                                        <input type="text" value={editRewardName} onChange={(e) => setEditRewardName(e.target.value)} className="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl text-base font-medium focus:ring-2 focus:ring-orange-500 outline-none" placeholder="Nama Barang" required />
                                        <div className="flex gap-4">
                                            <input type="number" value={editRewardPoints} onChange={(e) => setEditRewardPoints(e.target.value)} className="flex-1 p-4 bg-slate-50 border border-slate-200 rounded-2xl text-base font-medium focus:ring-2 focus:ring-orange-500 outline-none" placeholder="Poin" required />
                                            <div className="relative w-20 flex-shrink-0 h-14">
                                                <input type="file" accept="image/*" onChange={handleEditRewardImage} className="absolute inset-0 w-full h-full opacity-0 z-10 cursor-pointer" />
                                                <div className={`w-full h-full rounded-2xl flex items-center justify-center border-2 overflow-hidden ${editRewardImage ? 'border-orange-500' : 'border-slate-200 bg-slate-50'}`}>
                                                    {editRewardImage ? <img src={editRewardImage} className="w-full h-full object-cover" /> : <Icons.Upload size={24} className="text-slate-400" />}
                                                </div>
                                            </div>
                                        </div>
                                        <button type="submit" className="bg-orange-500 hover:bg-orange-600 text-white w-full py-4 rounded-2xl font-bold shadow-lg shadow-orange-500/20 transition active:scale-95 flex items-center justify-center gap-2 mt-2">Simpan Perubahan</button>
                                    </form>
                                </div>
                            </div>
                        )}

                        {/* MODAL TRANSAKSI BARU */}
                        {isAdmin && modalType && selectedMember && (
                            <div className="fixed inset-0 z-50 flex items-end md:items-center justify-center bg-slate-900/60 backdrop-blur-sm animate-fade-in">
                                <div className="bg-white w-full rounded-t-[2.5rem] md:rounded-3xl p-0 overflow-hidden shadow-2xl animate-slide-up md:max-w-md md:mx-4">
                                    <div className={`p-6 md:p-8 flex justify-between items-center text-white ${modalType === 'transaction' ? 'bg-gradient-to-r from-blue-600 to-blue-500' : 'bg-gradient-to-r from-orange-500 to-orange-400'}`}><div><h3 className="font-bold text-xl">{modalType === 'transaction' ? 'Tambah Poin' : 'Tukar Hadiah'}</h3><p className="text-sm opacity-90 text-white mt-1">untuk {selectedMember.name}</p></div><button onClick={closeModal} className="bg-white/20 hover:bg-white/30 p-2 rounded-full backdrop-blur-md transition"><Icons.X size={24} /></button></div>
                                    <div className="p-8 space-y-6 bg-white"><div className="flex justify-center -mt-14 mb-4"><div className="bg-white p-1.5 rounded-full shadow-lg"><div className="bg-slate-50 w-20 h-20 rounded-full flex items-center justify-center text-slate-500 font-black text-2xl border-4 border-white ring-1 ring-slate-100">{selectedMember.points}</div></div></div>
                                    
                                    <form onSubmit={modalType === 'transaction' ? handleTransaction : handleRedeem} className="space-y-6">
                                        {modalType === 'transaction' && (
                                            <>
                                                {/* INPUT JENIS TRANSAKSI (NEW) */}
                                                <div className="bg-slate-50 p-5 rounded-3xl border border-slate-100 focus-within:ring-2 focus-within:ring-blue-500 transition-all">
                                                    <label className="text-xs font-bold text-slate-400 ml-1 mb-2 block uppercase">Jenis Transaksi</label>
                                                    <div className="relative">
                                                        <select value={trxDescription} onChange={(e) => setTrxDescription(e.target.value)} className="w-full bg-transparent text-slate-800 font-bold text-lg outline-none appearance-none pr-8 cursor-pointer z-10 relative">
                                                            <option value="Transfer Sesama BRI">Transfer Sesama BRI</option>
                                                            <option value="Transfer Antar Bank">Transfer Antar Bank</option>
                                                            <option value="Tarik Tunai">Tarik Tunai</option>
                                                            <option value="Setor Tunai">Setor Tunai</option>
                                                            <option value="Pulsa / Data">Pulsa / Data</option>
                                                            <option value="Token Listrik / PLN">Token Listrik / PLN</option>
                                                            <option value="Top Up E-Wallet">Top Up E-Wallet</option>
                                                            <option value="Pembayaran BRIVA">Pembayaran BRIVA</option>
                                                            <option value="Lainnya">Lainnya</option>
                                                        </select>
                                                        <div className="absolute right-0 top-1/2 -translate-y-1/2 pointer-events-none text-slate-400">
                                                            <Icons.ChevronRight size={18} className="rotate-90" />
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* INPUT NOMINAL */}
                                                <div className="bg-slate-50 p-5 rounded-3xl border border-slate-100 focus-within:ring-2 focus-within:ring-blue-500 transition-all">
                                                    <label className="text-xs font-bold text-slate-400 ml-1 mb-2 block uppercase">Nominal Transaksi</label>
                                                    <div className="flex items-center">
                                                        <span className="text-slate-400 font-bold mr-3 text-xl">Rp</span>
                                                        <input type="text" inputMode="numeric" value={trxAmount} onChange={handleAmountChange} className="w-full bg-transparent text-slate-800 font-bold text-2xl outline-none placeholder:text-slate-300" placeholder="0" required autoFocus />
                                                    </div>
                                                </div>

                                                {/* INPUT LABA / PROFIT */}
                                                <div className="bg-green-50 p-5 rounded-3xl border border-green-100 focus-within:ring-2 focus-within:ring-green-500 transition-all">
                                                    <label className="text-xs font-bold text-green-600 ml-1 mb-2 block uppercase">Pendapatan / Admin</label>
                                                    <div className="flex items-center">
                                                        <span className="text-green-600 font-bold mr-3 text-xl">Rp</span>
                                                        <input type="text" inputMode="numeric" value={trxProfit} onChange={handleProfitChange} className="w-full bg-transparent text-green-800 font-bold text-2xl outline-none placeholder:text-green-300" placeholder="0" />
                                                    </div>
                                                </div>

                                                <div className="bg-blue-50 p-5 rounded-3xl border border-blue-100 flex justify-between items-center"><label className="text-sm font-bold text-blue-500 uppercase">Poin Otomatis</label><div className="text-blue-700 font-black text-2xl flex items-center gap-1"><span>+1</span><span className="text-sm font-bold opacity-70">Poin</span></div></div>
                                            </>
                                        )}
                                        {modalType === 'redeem' && (<div className="space-y-6"><div><label className="text-xs font-bold text-slate-400 ml-1 mb-3 block uppercase">Pilih Hadiah Cepat</label><div className="flex gap-4 overflow-x-auto pb-4 pt-1 px-1 scrollbar-hide snap-x">{rewards.map(reward => (<div key={reward.id} onClick={() => selectReward(reward)} className={`flex-shrink-0 w-32 p-4 rounded-2xl border-2 cursor-pointer transition relative overflow-hidden snap-start hover:shadow-md ${redeemNote === reward.name ? 'border-orange-500 bg-orange-50 ring-2 ring-orange-200' : 'border-slate-100 bg-white active:scale-95'}`}>{/* Image Thumbnail */}<div className="h-16 w-full bg-slate-50 rounded-lg mb-3 overflow-hidden flex items-center justify-center">{reward.imageType === 'custom' && reward.imageData ? (<img src={reward.imageData} alt="" className="w-full h-full object-cover" />) : (<Icons.Gift size={24} className="text-orange-300" />)}</div><div className="font-bold text-slate-700 text-xs truncate">{reward.name}</div><div className="text-xs text-orange-500 font-bold mt-1">{reward.points} Pts</div>{redeemNote === reward.name && <div className="absolute top-0 right-0 w-6 h-6 bg-orange-500 rounded-bl-xl text-white flex items-center justify-center text-xs">✓</div>}</div>))}</div></div><div className="bg-slate-50 p-5 rounded-3xl border border-slate-100"><label className="text-xs font-bold text-slate-400 ml-1 mb-2 block uppercase">Barang Ditukar</label><input type="text" value={redeemNote} onChange={(e) => setRedeemNote(e.target.value)} className="w-full bg-transparent text-slate-800 font-bold text-xl outline-none" placeholder="Ketik manual..." required /></div><div className="bg-red-50 p-4 rounded-3xl border border-red-100 flex justify-between items-center px-6"><label className="text-sm font-bold text-red-400 uppercase">Poin Dipotong</label><input type="number" value={pointInput} onChange={(e) => setPointInput(e.target.value)} className="w-24 bg-transparent text-red-600 font-black text-2xl outline-none text-right" required readOnly /></div></div>)}<button type="submit" className={`w-full py-5 rounded-2xl font-bold text-white shadow-lg transition transform active:scale-[0.98] text-lg ${modalType === 'transaction' ? 'bg-blue-600 active:bg-blue-700 shadow-blue-500/30' : 'bg-orange-500 active:bg-orange-600 shadow-orange-500/30'}`}>{modalType === 'transaction' ? 'Simpan' : 'Tukar Sekarang'}</button><div className="h-6 md:hidden"></div></form></div>
                                </div>
                            </div>
                        )}

                        {/* MODAL EDIT TRANSAKSI (NEW) */}
                        {editingTransaction && (
                            <div className="fixed inset-0 z-50 flex items-end md:items-center justify-center bg-slate-900/60 backdrop-blur-sm animate-fade-in">
                                <div className="bg-white w-full rounded-t-[2.5rem] md:rounded-3xl p-0 overflow-hidden shadow-2xl animate-slide-up md:max-w-md md:mx-4">
                                    <div className="p-6 md:p-8 flex justify-between items-center bg-blue-600 text-white">
                                        <div><h3 className="font-bold text-xl">Edit Transaksi</h3><p className="text-sm opacity-90 mt-1">Ubah data yang salah input</p></div>
                                        <button onClick={() => setEditingTransaction(null)} className="bg-white/20 hover:bg-white/30 p-2 rounded-full backdrop-blur-md transition"><Icons.X size={24} /></button>
                                    </div>
                                    <div className="p-8 space-y-6 bg-white">
                                        <form onSubmit={saveEditTransaction} className="space-y-6">
                                            {/* JENIS TRANSAKSI */}
                                            {editingTransaction.type === 'EARN' && (
                                                <div className="bg-slate-50 p-5 rounded-3xl border border-slate-100 focus-within:ring-2 focus-within:ring-blue-500 transition-all">
                                                    <label className="text-xs font-bold text-slate-400 ml-1 mb-2 block uppercase">Jenis Transaksi</label>
                                                    <div className="relative">
                                                        <select value={trxDescription} onChange={(e) => setTrxDescription(e.target.value)} className="w-full bg-transparent text-slate-800 font-bold text-lg outline-none appearance-none pr-8 cursor-pointer z-10 relative">
                                                            <option value="Transfer Sesama BRI">Transfer Sesama BRI</option>
                                                            <option value="Transfer Antar Bank">Transfer Antar Bank</option>
                                                            <option value="Tarik Tunai">Tarik Tunai</option>
                                                            <option value="Setor Tunai">Setor Tunai</option>
                                                            <option value="Pulsa / Data">Pulsa / Data</option>
                                                            <option value="Token Listrik / PLN">Token Listrik / PLN</option>
                                                            <option value="Top Up E-Wallet">Top Up E-Wallet</option>
                                                            <option value="Pembayaran BRIVA">Pembayaran BRIVA</option>
                                                            <option value="Lainnya">Lainnya</option>
                                                        </select>
                                                        <div className="absolute right-0 top-1/2 -translate-y-1/2 pointer-events-none text-slate-400"><Icons.ChevronRight size={18} className="rotate-90" /></div>
                                                    </div>
                                                </div>
                                            )}

                                            {/* NOMINAL (Hanya untuk EARN) */}
                                            {editingTransaction.type === 'EARN' && (
                                                <div className="bg-slate-50 p-5 rounded-3xl border border-slate-100 focus-within:ring-2 focus-within:ring-blue-500 transition-all">
                                                    <label className="text-xs font-bold text-slate-400 ml-1 mb-2 block uppercase">Nominal Transaksi</label>
                                                    <div className="flex items-center"><span className="text-slate-400 font-bold mr-3 text-xl">Rp</span><input type="text" inputMode="numeric" value={trxAmount} onChange={handleAmountChange} className="w-full bg-transparent text-slate-800 font-bold text-2xl outline-none placeholder:text-slate-300" placeholder="0" required /></div>
                                                </div>
                                            )}

                                            {/* LABA (Hanya untuk EARN) */}
                                            {editingTransaction.type === 'EARN' && (
                                                <div className="bg-green-50 p-5 rounded-3xl border border-green-100 focus-within:ring-2 focus-within:ring-green-500 transition-all">
                                                    <label className="text-xs font-bold text-green-600 ml-1 mb-2 block uppercase">Pendapatan / Admin</label>
                                                    <div className="flex items-center"><span className="text-green-600 font-bold mr-3 text-xl">Rp</span><input type="text" inputMode="numeric" value={trxProfit} onChange={handleProfitChange} className="w-full bg-transparent text-green-800 font-bold text-2xl outline-none placeholder:text-green-300" placeholder="0" /></div>
                                                </div>
                                            )}

                                            {/* CATATAN (Hanya untuk REDEEM) */}
                                            {editingTransaction.type === 'REDEEM' && (
                                                <div className="bg-slate-50 p-5 rounded-3xl border border-slate-100"><label className="text-xs font-bold text-slate-400 ml-1 mb-2 block uppercase">Barang Ditukar</label><input type="text" value={redeemNote} onChange={(e) => setRedeemNote(e.target.value)} className="w-full bg-transparent text-slate-800 font-bold text-xl outline-none" placeholder="Ketik manual..." required /></div>
                                            )}

                                            <button type="submit" className="w-full py-5 rounded-2xl font-bold text-white bg-blue-600 hover:bg-blue-700 shadow-lg shadow-blue-500/30 transition transform active:scale-[0.98] text-lg">Simpan Perubahan</button>
                                            <div className="h-6 md:hidden"></div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* MOBILE FLOATING NAVIGATION (Hidden on Desktop) */}
                        {isAdmin && (
                            <nav className="fixed bottom-6 left-6 right-6 bg-white/90 backdrop-blur-xl border border-white/50 shadow-[0_8px_30px_rgb(0,0,0,0.12)] rounded-3xl z-40 p-2 md:hidden">
                                <div className="flex justify-around items-center">
                                    <MobileNavBtn active={view === 'dashboard'} onClick={() => setView('dashboard')} icon={(active) => <Icons.Wallet size={22} strokeWidth={active ? 2.5 : 2} />} label="Home" />
                                    <MobileNavBtn active={view === 'members' || view === 'addMember'} onClick={() => setView('members')} icon={(active) => <Icons.Users size={22} strokeWidth={active ? 2.5 : 2} />} label="Member" />
                                    <MobileNavBtn active={view === 'rewards'} onClick={() => setView('rewards')} icon={(active) => <Icons.Gift size={22} strokeWidth={active ? 2.5 : 2} />} label="Hadiah" />
                                    <MobileNavBtn active={view === 'history'} onClick={() => setView('history')} icon={(active) => <Icons.History size={22} strokeWidth={active ? 2.5 : 2} />} label="Riwayat" />
                                </div>
                            </nav>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>